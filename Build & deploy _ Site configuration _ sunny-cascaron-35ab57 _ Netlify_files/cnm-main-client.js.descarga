(()=>{var rt=Date.now(),W=!("window"in globalThis)&&("serviceWorker"in globalThis||"registration"in globalThis&&"navigationPreload"in globalThis.registration),z="SW_VERSION_LOCAL",J="227c943f",v="netlify-cnm",xe="cnm-settings.json",ot=`/${v}/${xe}`,He="cnm-sw.js",G=`/${He}`,k="/cnm-main-client.js",We="cnm.js",Z=`/${v}/${We}`,Q="https://client-network-manager.netlify.app",st=`${Q}${G}`,it=`${Q}${k}`;var ee=1,U="__cnm-debug",F="__cnm-settings",I="ntl-cnm-",at=1e3*60,ct=1e3*10,lt=1e3*60*60*4,ve=["html","htm"],Ge=["js","mjs"],ke=["css"],Ue=["svg","jpg","jpeg","gif","png","webp","avif","bmp","ico"],Fe=["tiff","tif","woff","woff2","ttf"],Be=["aif","cda","mid","midi","mp3","mpa","wav","wma"],qe=["avi","mp4","mov"],gt=[...ve,...Ge,...ke,...Ue,...Fe,...Be,...qe,"txt","pdf"];var te="disabled";var ne="enabled",re="enabled",oe="disabled";var se="cnm-sig-db-v1";var ie="cnm-settings-v1";var ae="cnm-hits-v1";var ce="api",le="config",ge="lookahead";var $e=1e3*60,dt=1e3*60*60,ut=1e3*60*60;var Ke="nomod",ft=Ke.length;var Et=`/${v}/deltas/`;var m=!1,je="localStorage"in globalThis&&globalThis.document!==void 0,Ve=je?`MAIN-${J}`:`SW-${z}`,de=!1;function fe(){if(!de){de=!0;try{JSON.parse(localStorage.getItem("cnm-debug")||"")===!0&&(m=!0)}catch{}}}function B(e){try{m!==!!e&&(m=!!e,m?localStorage.setItem("cnm-debug",JSON.stringify(m)):localStorage.removeItem("cnm-debug"))}catch{}}function Ee(){return B(!m)}function q(){return location.href.includes(U)?!location.href.includes(`${U}=0`):null}function N(e,...t){m&&console[e](...t)}function P(e,t=90,n=80){let r=0;for(let s=0;s<e.length;s++)r=e.charCodeAt(s)+((r<<5)-r),r=r&r;return`hsl(${r%360}, ${t}%, ${n}%)`}var ue=e=>{let t=`%cCNM ${Ve} ::`;return e&&(t=`${t} ${e} ::`),{log:N.bind(null,"log",t,`background: ${e?P(e):"#bbb"}`),error:N.bind(null,"error",t,`background: ${e?P(e):"#bbb"}`),warn:N.bind(null,"warn",t,`background: ${e?P(e):"#bbb"}`),info:N.bind(null,"info",t,`background: ${e?P(e):"#bbb"}`),table:N.bind(null,"table",t,`background: ${e?P(e):"#bbb"}`)}},_={...ue(),namespace:e=>({...ue(e)})};function _e(){try{let e=localStorage.getItem("nf_internal"),t=e!==null?e||e==="true":!1;return e===null&&((localStorage.getItem("nf-team")==="netlify"||localStorage.getItem("ajs_user_traits")?.includes("@netlify.com")||localStorage.getItem("dvc:user")?.includes("@netlify.com"))&&(t=!0),localStorage.setItem("nf_internal",t?"true":"false")),t?"enabled":"disabled"}catch(e){console.error("couldnt randomize deltas access"),console.error(e)}}function f(){let e=new URL(location.href),t=globalThis.netlify?.cnm?.settings;if(e.searchParams.has(F)){let n=JSON.parse(e.searchParams.get(F)||""),r={...t};return n?.clientCaching&&(r.clientCaching=n.clientCaching),n?.cachingOptions&&(r.cachingOptions=n.cachingOptions),n?.deltaEncoding?r.deltaEncoding=n.deltaEncoding:r.deltaEncoding==="enabled"&&window.location.origin.includes("netlify.com")&&!window.location.origin.includes("--")&&(r.deltaEncoding=_e()),r}return t.deltaEncoding==="enabled"&&window.location.origin.includes("netlify.com")&&!window.location.origin.includes("--")&&(t.deltaEncoding=_e()),t}function R(){return f()?.clientCaching!==te}var b={},w=_.namespace("MSG-HANDLER"),he=!1,$;W&&self.addEventListener("message",Se);function pe(e){w=_.namespace("MSG-HANDLER"),b=e.messageHandlers||{},$=e.signalsManager,e.messageListener&&!he&&(he=!0,e.messageListener.addEventListener("message",Se))}function Se(e){if(!e.data||!e.data.cnm)return;let{type:t,payload:n}=e.data,r=e.source;Object.keys(b).forEach(s=>{if(s===t||s.startsWith(`${t}_once_`)){let i=b[s];if(i)try{w.log(`start message handler for type "${t}"`);let c={type:t,payload:n,client:r};W&&$&&(c.serviceWorkerContext={signalsManager:$}),i(c),w.log(`end message handler for type "${t}"`)}catch(c){w.error(`message handler for type "${t}" threw an error`),w.error(c)}s.includes("_once_")&&delete b[s]}})}var Xe=0;function me(e,t){b[`${e}_once_${Xe}`]=t}function u(e,t={}){let n=navigator?.serviceWorker?.controller;n&&(R()||e==="SELF_DESTRUCT")&&n.postMessage({cnm:!0,type:e,payload:t})}var O=!0;try{globalThis.localStorage.getItem("access_check__")}catch{O=!1}var Ce=e=>O?globalThis.localStorage.getItem(e):void 0,Te=(e,t)=>O?globalThis.localStorage.setItem(e,t):void 0,Ie=e=>O?globalThis.localStorage.removeItem(e):void 0;function Re(e){return e.pathname.startsWith(G)||e.pathname.startsWith(k)||e.pathname.startsWith(Z)}var y={},A=_.namespace("CACHE");function Ae(e){return e&&`${I}-${ee}-${e}`}async function Ye(e){A.log("start clearing caches",{signalKeys:e}),await Promise.allSettled(e.map(async t=>{let n="";typeof t=="object"?n=t.raw:typeof t=="string"&&(n=t),n&&(n=n.startsWith(I)?n:Ae(n),y[n]||(y[n]=await caches.open(n)),y[n]&&(caches.delete(n),delete y[n]))})),A.log("end clearing caches",{signalKeys:e})}async function ze(e){A.log("start clearing all caches except these signals",{signalKeys:e});let t=await caches.keys(),n=e.map(({raw:s})=>Ae(s)),r=t.filter(s=>!n.includes(s)&&s.startsWith(I));r.length>0&&(A.log("keep cache keys",n),A.log("delete cache keys",r)),await Ye(r),A.log("end clearing all other caches")}async function Ne(){await ze([])}function Pe(){if(f().cachingOptions?.precachingLookahead===oe)return;let e=[];document.querySelectorAll("img[loading=lazy]").forEach(t=>{"complete"in t&&!t.complete&&("currentSrc"in t&&t.currentSrc?e.push({url:t.currentSrc,destination:"image"}):"src"in t&&t.src?e.push({url:t.src,destination:"image"}):"href"in t&&t.href&&e.push({url:t.href,destination:"image"}))}),e.length>0&&D(e,ge)}function D(e,t){u("PRECACHE_RESOURCES",{resources:e,src:t})}var we=({payload:e})=>{if(f().cachingOptions?.precachingLookahead===re&&e&&typeof e.maxPrecache=="number"){let{maxPrecache:n}=e,r=0;document.querySelectorAll("img[loading=lazy]").forEach(s=>{"complete"in s&&!s.complete&&"loading"in s&&r<=n&&(s.loading="eager",r++)})}},be=()=>{let e=f().cachingOptions?.precachingConfiguredRoutes;Array.isArray(e)&&e.length>0&&D(e.map(t=>({url:t})),le)};function C(e,t,n){let r=e.length;if(!r)return;if(n=Object.prototype.toString.call(n)=="[object Function]"?n:function(l){return l},t=+t,t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);let s=(r-1)*t,i=Math.floor(s),c=+n(e[i],i,e),d=+n(e[i+1],i+1,e);return c+(d-c)*(s-i)}var p=self.location.origin,Je=self.location.hostname,Ze=Je==="netlify.com"||p.endsWith(".netlify.com")||p.endsWith("--app.netlify.app")||p.endsWith("--docs.netlify.app")||p.endsWith("--www.netlify.app")||p.endsWith("--app.netlify.com")||p.endsWith("--www.netlify.com")||p.endsWith("--docs.netlify.com"),Qe=p.endsWith("--client-network-manager.netlify.app")||p.endsWith("client-network-manager.netlify.app"),L=_.namespace("rum-reporter");function M(){return Ze&&"DD_RUM"in window||Qe}function T(e,t){L.log("RUM log:",e,t),M()&&"DD_RUM"in window&&window.DD_RUM.addAction(e,t)}function x(e,t){L.log("RUM global context:",e,t),M()&&"DD_RUM"in window&&window.DD_RUM.addRumGlobalContext(e,t)}var Le={meta:{},stats:{},races:[],deltaResponses:[]},E={...Le};async function et(e="unknown"){if(document.visibilityState==="hidden"||!M())return;let t=await Promise.race([window.netlify?.cnm?.getStats?.(),new Promise(a=>{setTimeout(()=>{a(null)},1e3)})]);if(!t||typeof t!="object"||!("stats"in t))return;let n=t,r=!!(n&&"meta"in n)&&typeof n.stats=="object",s=E?.meta?.version;n.meta.version&&s&&s!==n.meta.version&&(E={...Le});let i=!!(E&&"meta"in E)&&typeof E.stats=="object",c=r&&i?Object.keys(n.stats).reduce((a,g)=>(isNaN(n.stats[g])||isNaN(E.stats[g])?a[g]=n.stats[g]:a[g]=n.stats[g]-E.stats[g],a),{}):n.stats,d={...n,stats:c,races:[],deltaResponses:[]},l={};if("races"in n&&Array.isArray(n.races)){let a=n.races,g=E.races.length?a.slice(E.races.length):a;d.races=g}else d.races=[];if(d.races.length>0){l.count=d.races.length;let a=d.races.map(({delta:o})=>o).filter(o=>!isNaN(o)&&o!==1/0).sort((o,h)=>o-h);l.deltaAvg=a.reduce((o,h)=>o+h,0)/a.length,l.deltaP0=a[0],l.deltaP25=C(a,.25,o=>o),l.deltaP50=C(a,.5,o=>o),l.deltaP75=C(a,.75,o=>o),l.deltaP100=a[a.length-1];let g=d.races.map(({newPathResult:o,oldPathResult:h})=>{let Y=(o-h)/h;return Y?Math.round((Y*100+Number.EPSILON)*100)/100:0}).filter(o=>!isNaN(o)&&o!==1/0).sort((o,h)=>o-h);l.changePercAvg=g.reduce((o,h)=>o+h,0)/g.length,l.changePercP0=g[0],l.changePercP25=C(g,.25,o=>o),l.changePercP50=C(g,.5,o=>o),l.changePercP75=C(g,.75,o=>o),l.changePercP100=g[g.length-1],l.slowerCount=a.filter(o=>o>0).length,l.fasterCount=l.count-l.slowerCount,M()&&(d.races.forEach(o=>{!o.newPathResult||!o.oldPathResult||T("RACE_RESULT",{raceType:o.raceType||"cnm-fetch-race",raceCondition:e,totalInGroup:d.races.length,deltaChangePercentage:(o.newPathResult-o.oldPathResult)/o.oldPathResult*100,deltaChangeMultiple:o.oldPathResult/o.newPathResult,...o})}),L.log("Races from last view change",d.races))}if("deltaResponses"in n&&Array.isArray(n.deltaResponses)){let a=n.deltaResponses,g=E.deltaResponses.length?a.slice(E.deltaResponses.length):a;d.deltaResponses=g}else d.deltaResponses=[];if(d.deltaResponses.length>0&&(d.deltaResponses.forEach(a=>{T("DELTA_ENCODING_RESULT",{...a})}),L.log("Deltas from last view change",d.deltaResponses)),r){let a={...d,raceResults:l,cnmStatsTrigger:e};delete a.races,delete a.deltaResponses,L.log("Stats from last view change",a),T("CNM_STATS",a)}E=n}var tt=0,K;function Oe(){K&&clearTimeout(K),K=setTimeout(()=>{et(tt++===0?"page_load":"route_change")},3e3)}function V(e){document.readyState==="complete"?e():window.addEventListener("load",e)}function j(){ye.forEach(e=>e())}var ye=[];V(function(){window.addEventListener("popstate",j);let e=window.history.pushState;window.history.pushState=function(...n){return j(),e.apply(window.history,n)};let t=window.history.replaceState;window.history.replaceState=function(...n){return j(),t.apply(window.history,n)}});function De(e){ye.push(e),e()}var H=_.namespace("destroyer");async function X(){let e=f();if("serviceWorker"in navigator&&e?.cnmSWLocation){let t=await navigator.serviceWorker.getRegistrations(),n=new URL(e.cnmSWLocation,location.origin).href,r=t.find(({active:s})=>s&&s.scriptURL===n);if(r)H.log("start destroying sw and artifacts"),u("SELF_DESTRUCT"),setTimeout(()=>{r.unregister().then(s=>{H.log(`sw unregistered itself? ${s?"main thread unregistered":"sw self destroyed"}.`)})},100);else{let s=await caches.keys();s.length>0&&s.find(c=>c.startsWith(I))?await Promise.allSettled([Ne(),()=>{self.indexedDB.deleteDatabase(ie),self.indexedDB.deleteDatabase(se),self.indexedDB.deleteDatabase(ae)}]).then(c=>{H.log("end destroying sw and artifacts",{results:c})}):H.log("sw or artifacts do not exist, not running destroy fns")}}}fe();var S=_.namespace("MAIN-CLIENT");async function nt(){let e=f();if("serviceWorker"in navigator&&e?.cnmSWLocation){let t=await navigator.serviceWorker.getRegistrations(),n=!1,r=new URL("/",location.origin).href,s=new URL(e.cnmSWLocation,location.origin).href;t.forEach(({scope:i,active:c})=>{i===r&&c&&c.scriptURL!==s&&(n=!0)});try{if(n)return;await navigator.serviceWorker.register(e.cnmSWLocation,{updateViaCache:"none"}),Me(),pe({messageHandlers:{SW_ACTIVATION_PROCESS_COMPLETE:()=>Me(),GET_PRE_CNM_ASSET_REFS:()=>{V(()=>{let i=[];performance.getEntriesByType("resource").filter(({name:c})=>{c.startsWith(location.origin)&&!Re(new URL(c,location.origin))&&i.push(c)}),T("CNM_PRE_CNM_RESOURCES",{resourceCount:i.length}),i.length>0?(S.log("Hydrate pre-CNM resources",i),u("HYDRATE_RESOURCES_FROM_HTTP_CACHE",{resources:i})):S.log("no pre-CNM should be hydrated",i)})},HYDRATION_STATS:({payload:i})=>{i&&(S.log("hydrate resource stats",i),T("CNM_HYDRATION_STATS",i))},PRECACHE_STATS:({payload:i})=>{i&&(S.log("precaching stats",i),T("CNM_PRECACHE_STATS",i))},PRECACHE_LOOKAHEADS:we},messageListener:navigator.serviceWorker})}catch(i){S.error(`Registration failed with ${i}`)}}}function Me(){u("EXPLICIT_ACTIVATE");let e=q();e&&u("TOGGLE_DEBUG",{on:e}),u("UPDATE_CLIENT_SETTINGS",f()),be()}(async()=>{if(window.__cnmjsInvoked){S.error("client has been loaded multiple times. This script will stop");return}window.__cnmjsInvoked=!0;let e=q();e!==null&&await B(e);let t=f();if(!t){S.error("settings have not been provided by the snippet. This client will not run");return}window.netlify=window.netlify||{},window.netlify.cnm=window.netlify.cnm||{},window.netlify.cnm.refreshSignal=()=>u("EXPLICIT_SIGNAL_FETCH"),window.netlify.cnm.fetchUrlFromCache=r=>u("FETCH_FROM_CACHE",{url:r}),window.netlify.cnm.precacheResources=r=>D(r,ce),window.netlify.cnm.messageSW=u,window.netlify.cnm.getStats=()=>new Promise(r=>{me("NET_STATS",({payload:s})=>{r(s)}),u("GET_NET_STATS")}),window.netlify.cnm.toggleDebug=()=>{u("TOGGLE_DEBUG"),Ee()},window.netlify.cnm.destroySW=()=>X();let n=!!Ce("cnm_sw_enabled")&&R();R()?(S.log("SW is Enabled. Setting value: ",t.clientCaching),nt(),n||Te("cnm_sw_enabled","true")):(S.log("SW is disabled. Setting value: ",t.clientCaching),X(),Ie("cnm_sw_enabled")),De(()=>{Oe(),Pe()}),x("cnmSWEnabled",R()),x("cnmSWPreviouslyEnabled",n),x("cnmNavResourceAffinityEnabled",f().cachingOptions?.navResourceAffinity===ne)})();})();
